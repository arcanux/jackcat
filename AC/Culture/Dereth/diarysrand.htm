<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

<meta name="GENERATOR" content="Microsoft FrontPage 6.0">
<title>Dev Diary: Srand</title>

<style><!--
.Head
	{font-family:Arial;
	font-size:10pt;
	color:#FFFFFF;}
.Title2
	{font-family:Arial;
	font-size:12pt;
	color:#FFFFFF;}
-->
</style>
<meta name="Microsoft Border" content="b">
</head>

<body bgcolor="#400040" text="#FFFFFF" link="#FFFFFF" vlink="#D6D2DD" alink="#761F69"><!--msnavigation--><table dir="ltr" border="0" cellpadding="0" cellspacing="0" width="100%"><tr><!--msnavigation--><td valign="top">
<div align="center"><center>

<table border="1" cellpadding="6" width="728" bgcolor="#6B6B6B" bordercolorlight="#FFFFFF" cellspacing="1">
  <tr>
    <td width="109">&nbsp;</td>
    <td valign="top" width="458">
      <p align="center"><span lang="en-us">
		<font face="Times New Roman" size="5">Dev Diary: Srand</font></span></td>
    <td width="113">&nbsp;</td>
  </tr>
  <tr>
    <td valign="top" width="109"><a href="../Aluvian/Aluvian.htm"><font size="2" face="Arial"><strong>
    Aluvians</strong></font></a>
      <p><a href="../Gharundim/Gharun.htm"><font size="2" face="Arial"><strong>
      Gharu'ndim</strong></font></a></p>
      <p><a href="../Sho/Sho.htm"><font size="2" face="Arial"><strong>
      Sho</strong></font></a></p>
	<p><strong><font face="Arial" size="2">
	<a href="../Viamontian/Viamontian.htm">
	Viamontians</a></font></strong></p>
      <p><a href="../Ispar/Ispar.htm"><font size="2" face="Arial"><strong>
      Ispar History<br>
      <br>
      </strong></font></a><a href="Dereth.htm"><font size="2" face="Arial"><strong>
      Auberean History</strong></font></a></p>
      <p><a href="../Texts/Texts.htm"><font size="2" face="Arial"><strong>
      Texts</strong></font></a></p>
      <p><a href="../Parchments/Parchmnt.htm"><font size="2" face="Arial"><strong>
      Rumors</strong></font></a></td>
    <td valign="top" width="442">
    <div class="headlineSmall">
		<span lang="en-us"><font face="Arial" size="2">From the
		<a target="_blank" href="http://ac.turbinegames.com/index.php?page_id=284">
		Turbine Site</a> - Oct. 11, 2004</font></span><p>
		<font size="2" face="Arial">I'm going to let you in on a little trade 
		secret today. I'm going to tell you about my number one tool, the 
		primary and consummate method I have in my repertoire for dealing with 
		an ancient, largely undocumented, and extremely fractious code base. 
		This is not knowledge to be used lightly nor to be disseminated without 
		caution. This is the end result of over three years of working with the 
		Asheron's Call code base, the by-product of years of toil and travail, 
		and I offer it to you today. And this secret method is: Find in Files. 
		Yes, the simple ability to search thousands of code files all at once 
		for all instances of a particular text string. </font></p>
		<p><font size="2" face="Arial">Let's look at an example. Last week I 
		began the work of switching total experience from a 32-bit integer to a 
		64-bit integer. I started by finding the name of the value that stores 
		the player's total experience: TOTAL_EXPERIENCE_INT. (For the record, 
		this isn't the data member itself, but the key enumeration of it's entry 
		in the flexible hash table we use for most player data storage.) As it 
		happened, I knew exactly where to find the name of this value, but if I 
		hadn't I would have started by searching the entire bloody code base for 
		the word 'experience' and seeing what turned up. </font></p>
		<p><font size="2" face="Arial">Once I had the name, I searched the 
		entire bloody code base to see where it was referenced. And I do mean 
		the entire code base, including networking, graphics, data preprocessing 
		&amp; Most of our game systems code is confined to a few well-known 
		locations on the client and server, but you never know where something 
		is going to turn up. PK status, for instance, was assumed to be 
		game-agnostic and so was originally defined deep in the engine code. We 
		never did end up building another game on this engine, so it's somewhat 
		moot now, but it does make things interesting to track down.</font></p>
		<p><font size="2" face="Arial">So, what did I find when I went looking 
		for TOTAL_EXPERIENCE_INT? I found two nice clean accessors on the 
		server, plus a bunch of places where the accessors should have been 
		called but weren't, and a lot of nasty hard-coded references on the 
		client. Well, the client is like that. We're working on it, but that's a 
		work in progress, so I set that aside for a bit to deal with later. On 
		the server, I marked the places that should be accessors with a nice 'TODO 
		LEVELCAP' comment and went searching for everywhere that the code called 
		the accessors. At this point I knew that the code was pretty well 
		confined to a class called WAgent (players and creatures and NPCs, more 
		or less), but I still searched the entire bloody code base anyway – it's 
		better not to be surprised. </font></p>
		<p><font size="2" face="Arial">That search lead me to two methods called 
		AddCharacterPoints (the old name for available experience) and 
		AddProficiencyPoints (the experience that goes directly into your 
		skills). When I searched for everywhere these methods are used, I found 
		about what I expected. AddProficiencyPoints is called by NPCs (for quest 
		rewards) and when using a skill gives you skill experience. 
		AddCharacterPoints is called by NPCs (for quest rewards), by the 
		allegiance system (for allegiance XP), by the fellowship system (for 
		fellowship XP), and by creatures when you kill them. It's also, however, 
		called by AddProficiencyPoints – because 10% of the XP you earn by using 
		skills is also added to your available experience. I knew that, at some 
		point, but I'd forgotten it, so it's a good thing I did a search or I 
		might have missed this case. </font></p>
		<p><font size="2" face="Arial">I continued searching backwards from 
		there, but I didn't find anything terrible interesting so I'll spare you 
		the details. At any rate, all my searching gave me enough information to 
		decide where in the code path we need to start supporting 64-bit 
		integers and pointed out all the locations on the server I would need to 
		modify to match. It also allowed me to make some minor improvements to 
		bits of the code path that were less than optimal – turns out we were 
		doing some silly stuff to figure out if you had leveled every time you 
		gained XP – and reminded me of extra test cases to write up in the 
		specification. You can see why I say that searching is one of my 
		foremost coding tools. There's nothing magical about working with our 
		code base; it's just a matter of finding a starting point and unraveling 
		things in a logical fashion from there. </font></p>
		<p><font size="2" face="Arial">Now, on to the client!</font><br>
&nbsp;</div>
	</td>
    <td width="113" valign="top">&nbsp;</td>
  </tr>
</table>
</center></div>

<!--msnavigation--></td></tr><!--msnavigation--></table><!--msnavigation--><table border="0" cellpadding="0" cellspacing="0" width="100%"><tr><td>

<p align="center"><font face="Arial"><br>
<a href="../../Travel/travel.htm" Target="_top"><small>
<small>Transportation</small></small></a> <small>
<small>| 
<a Target="_top" href="../../places.asp.html">Tourism</a> 
| <a href="../../Food/Food.htm" Target="_top">
Restaurants</a> | 
<a href="../../Apparel/apparel.htm" Target="_top">Apparel</a> 
| <a Target="_top" href="../../pets.asp.html">Pets</a> 
| <a href="../../Sports/sports.htm" Target="_top">
Sports</a> | 
<a href="../../Careers/careers.htm" Target="_top">Careers</a> 
| 
<a href="../../Hobbies/hobbies.htm" Target="_top">Hobbies</a> 
| 
<a href="../culture.htm" Target="_top">Culture</a> 
| 
<a href="../../Shopping/shopping.htm" Target="_top">
Shopping</a> | 
<a href="../../Odds&apos;nEnds/oddsends.htm" Target="_top">
Odds &amp; Ends</a> | 
<a href="../../Directory/index.htm" Target="_top">
Directory</a> <br>
<a href="http://forums.thejackcat.com/">Forums</a> |
<a href="../../Home/Search.htm">Search</a> |
<a href="../../index.html" Target="_top">Home</a></small></small></p>
<p align="center"><font face="Arial" size="-2">© Copyright 
1999<span lang="en-us"> - 200</span>6 by Maggie the Jackcat. <br>
This page is not affiliated with 
<a Target="_blank" href="http://www.turbinegames.com/">Turbine, Inc</a>.
The opinions expressed on this site are solely my own.&nbsp; <br>
Asheron's Call is a registered trademark of Turbine, Inc.<br>
Send email to <a href="mailto:Maggie@thejackcat.com">
Maggie@thejackcat.com</a> </font></p>
</font>


</td></tr><!--msnavigation--></table></body></html>